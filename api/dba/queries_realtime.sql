  1 | Vigos   | adm@vigossolucoes.com.br     | $2a$05$A1Xso4kAVGLXxpJj1oAIxO5o4JR.PA0OdBKqZTwra10JQ62FCirj. | 7000     | admin | t
  2 | Api     | api@vigossolucoes.com.br     | $2a$05$jbclBshzhwZhCyMgjbTcfOoeiOrGSv1Hyp6XIHZavat2.O8EnMARC | 7000     | api   | t
  3 | User    | user@vigossolucoes.com.br    | $2a$05$t77fhcB.jNZLLiYys6.aFuI5dZ07kTa/uTuF9cuIMK.TeyFfCp5Za | 7000     | user  | t
  4 | Gustavo | gustavo@vigossolucoes.com.br | $2a$05$jbclBshzhwZhCyMgjbTcfOoeiOrGSv1Hyp6XIHZavat2.O8EnMARC | 4108     | admin | t
  5 | Victor  | victor@vigossolucoes.com.br  | $2a$05$ABJrNY5NXVQzgoMqenBlBuScfsCeFPtDxFp1qtyy8ovnJeluZqq4m | 4109     | admin | t

 38 | Marcos   | suporte@gsbru.com.br                  | $2a$05$m6zk71NJI8j3zkoATAvZf.t5B.PGnmKOfgP6Ixi4jg6uy4s1//LSy | 2030     | user  | t
 39 | Rogerio  | rogerio@gsbru.com.br                  | $2a$05$m6zk71NJI8j3zkoATAvZf./.PNJ0HXVDhAWi4QcDX0p0QaAviMxye | 2024     | admin | t
 40 | Carol    | recepcao@gsbru.com.br                 | $2a$05$m6zk71NJI8j3zkoATAvZf.0KLUpoxjqhYJflBCdyRp6lePu5.GrGm | 2001     | user  | t
 41 | Giovanna | recepcao1@gsbru.com.br                | $2a$05$m6zk71NJI8j3zkoATAvZf.8ulJoHG51B1Zm/6VGuEtR1LRrgyfmJy | 2000     | user  | t

INSERT INTO users (name, email, password, endpoint, role, active) VALUES ('Vigos', 'adm@vigossolucoes.com.br', '$2a$05$A1Xso4kAVGLXxpJj1oAIxO5o4JR.PA0OdBKqZTwra10JQ62FCirj.', '2000', 'admin', 'true');
INSERT INTO users (name, email, password, endpoint, role, active) VALUES ('User', 'user@vigossolucoes.com.br', '$2a$05$t77fhcB.jNZLLiYys6.aFuI5dZ07kTa/uTuF9cuIMK.TeyFfCp5Za', '9900', 'user', 'true');
INSERT INTO users (name, email, password, endpoint, role, active) VALUES ('Support', 'support@vigossolucoes.com.br', '$2a$05$jbclBshzhwZhCyMgjbTcfOoeiOrGSv1Hyp6XIHZavat2.O8EnMARC', '9900', 'tecnical', 'true');

INSERT INTO users (name, email, password, endpoint, role, active) VALUES ('Gustavo', 'gustavo@vigossolucoes.com.br', '$2a$05$jbclBshzhwZhCyMgjbTcfOoeiOrGSv1Hyp6XIHZavat2.O8EnMARC', '4108', 'admin', 'true');
INSERT INTO users (name, email, password, endpoint, role, active) VALUES ('Victor', 'victor@vigossolucoes.com.br', '$2a$05$ABJrNY5NXVQzgoMqenBlBuScfsCeFPtDxFp1qtyy8ovnJeluZqq4m', '4109', 'admin', 'true');

INSERT INTO users (name, email, password, endpoint, role, active) VALUES ('Salete', 'salete@agrosolo.com.br', '$2a$05$vbjKbVzigocllTO2qvHZ6.qeZpM7bz1fwxz/W0rUt3xJlDzBY0GoG', '1152', 'admin', 'true');

INSERT INTO users (name, email, password, endpoint, role, active) VALUES ('Recepcao', 'recepcaomonsenhor@magna.med.br', '$2a$05$I69z7Eqhu8zoPBFYIbqgmew6AObLz2QolP0BbInR4shLU26HG/OBm', '2500', 'user', 'true');
INSERT INTO users (name, email, password, endpoint, role, active) VALUES ('Recepcao', 'recepcaohb@magna.med.br', '$2a$05$IRMSFDUgHg0bqfktB7Jj3.ki/02gBBpzUr7Kai3VkVD29yU0eluZ2', '2600', 'user', 'true');
INSERT INTO users (name, email, password, endpoint, role, active) VALUES ('Recepcao', 'recepcaoaeroporto@magna.med.br', '$2a$05$IRMSFDUgHg0bqfktB7Jj3.il3LjkjrSo/RSCOF6576bcrygrXA4BC', '2300', 'user', 'true');
INSERT INTO users (name, email, password, endpoint, role, active) VALUES ('Recepcao', 'recepcaocomendador@magna.med.br', '$2a$05$YWvEiOQpSd5amcr41tKVeO3eIhRItF0GEb/M8XegZ8u.Q/gQ/7Lci', '2300', 'user', 'true');

INSERT INTO users (name, email, password, endpoint, role, active) VALUES ('Recepção', 'recep.bru@lagosan.com.br', '$2a$05$k9DIiCUqu1ALHOohEByIEOCuARFuc2p7gSVXeB.tsGUf.XQHonqjy', '6200', 'user', 'true');
INSERT INTO users (name, email, password, endpoint, role, active) VALUES ('Vendas', 'auxvendas.jau@lagosan.com.br', '$2a$05$otXhMerurrt1Gobom4bUOOKpewrVwEX/7RYmxfHcP8Byw6gpESnjy', '7100', 'user', 'true');

INSERT INTO users (name, email, password, endpoint, role, active) VALUES ('Telefonista', 'telefonista.fac@lagosan.com.br', '$2a$05$d3DTXdPa2VvSLMWuKHyG7.nPAUqeMflL/TtKFjd2WWZ5Qjtc7q70u', '6200', 'user', 'true');
INSERT INTO users (name, email, password, endpoint, role, active) VALUES ('Recepção', 'recepcao.fac@lagosan.com.br', '$2a$05$d3DTXdPa2VvSLMWuKHyG7.nPAUqeMflL/TtKFjd2WWZ5Qjtc7q70u', '6200', 'user', 'true');

INSERT INTO users (name, email, password, endpoint, role, active) VALUES ('Cardans', 'cardans.blv@terra.com.br', '$2a$05$0ASUnKmkzjnRO7RRBxxvhOZ9gDlPow5rfPCyl8us1UVGIzA1QIFjC', '4599', 'admin', 'true');

INSERT INTO users (id, name, email, password, endpoint, role, active) VALUES (8, 'Noel', 'noel@agrosolo.com.br', '$2a$05$6pYafCk/Ni2YbsO5z4xYWu7RVCgdBwk0MyAKhNaKC1qD8RV9XSQ8e', '7100', 'admin', 'true');
INSERT INTO users (id, name, email, password, endpoint, role, active) VALUES (9, 'Gustavo', 'gustavo@agrosolo.com.br', '$2a$05$6pYafCk/Ni2YbsO5z4xYWud1c.Tb/cEok5hWbrGaOwECiN1ihrQVm', '7100', 'user', 'true');
INSERT INTO users (id, name, email, password, endpoint, role, active) VALUES (10, 'Robert', 'robert@agrosolo.com.br', '$2a$05$6pYafCk/Ni2YbsO5z4xYWud1c.Tb/cEok5hWbrGaOwECiN1ihrQVm', '7100', 'user', 'true');

INSERT INTO users (name, email, password, endpoint, role, active) VALUES ('Recepção', 'recepcao.3199@caminhoveiculos.com.br', '$2a$05$anEth7NFmaXJLQ4TH5G4y.La053LTWt7dUiaVh8J0C90zX/NzOO52', '4000', 'user', 'true');
INSERT INTO users (name, email, password, endpoint, role, active) VALUES ('Recepção', 'recepcao.90350@fiatcaminho.com.br', '$2a$05$anEth7NFmaXJLQ4TH5G4y.mq58PIGT9zD7M4uSUycfcXVmnDuckUG', '4000', 'user', 'true');
INSERT INTO users (name, email, password, endpoint, role, active) VALUES ('André', 'andre.ruiz@caminhoveiculos.com.br', '$2a$05$anEth7NFmaXJLQ4TH5G4y.xGUa.4PDDFwuXbyuJGSM090r5F3taBK', '6305', 'admin', 'true');

INSERT INTO users (name, email, password, endpoint, role, active) VALUES ('Sergio', 'sergio@refrigas.com.br', '$2a$05$DED/ROFo7ZoxL8y0M6rB4O7mpNEdvmPiKJkCIABPnJrwXS7yAyNVC', '9999', 'user', 'true');

INSERT INTO users (name, email, password, endpoint, role, active) VALUES ('Vendas', 'auxvendas.btu@lagosan.com.br', '$2a$05$lBK1ZAM4OVNx6dSnLlUcGOGD.bRBcZxPaHui.rcyYnY0sWTmyX6nS', '9999', 'user', 'true');

INSERT INTO users (name, email, password, endpoint, role, active) VALUES ('Marcos', 'suporte@gsbru.com.br', '$2a$05$m6zk71NJI8j3zkoATAvZf.t5B.PGnmKOfgP6Ixi4jg6uy4s1//LSy', '2030', 'user', 'true');
INSERT INTO users (name, email, password, endpoint, role, active) VALUES ('Rogério', 'rogerio@gsbru.com.br', '$2a$05$m6zk71NJI8j3zkoATAvZf./.PNJ0HXVDhAWi4QcDX0p0QaAviMxye', '2024', 'admin', 'true');
INSERT INTO users (name, email, password, endpoint, role, active) VALUES ('Carol', 'recepcao@gsbru.com.br', '$2a$05$m6zk71NJI8j3zkoATAvZf.0KLUpoxjqhYJflBCdyRp6lePu5.GrGm', '2001', 'user', 'true');
INSERT INTO users (name, email, password, endpoint, role, active) VALUES ('Giovanna', 'recepcao1@gsbru.com.br', '$2a$05$m6zk71NJI8j3zkoATAvZf.8ulJoHG51B1Zm/6VGuEtR1LRrgyfmJy', '2000', 'user', 'true');


TRUNCATE TABLE users;
TRUNCATE TABLE cdr;
TRUNCATE TABLE ps_aors;
TRUNCATE TABLE ps_auths;
TRUNCATE TABLE ps_endpoints;
TRUNCATE TABLE ps_registrations;
TRUNCATE TABLE ps_endpoint_id_ips;
TRUNCATE TABLE queues;
TRUNCATE TABLE queue_members;
TRUNCATE TABLE musiconhold CASCADE;
TRUNCATE TABLE musiconhold_entry;

INSERT INTO ps_endpoints
        (id, transport, aors, auth, context, callerid, language, inband_progress, rtp_timeout, message_context, allow_subscribe, subscribe_context, direct_media, dtmf_mode, device_state_busy_at, disallow, allow, named_call_group, named_pickup_group, force_rport, rewrite_contact, rtp_symmetric)
      VALUES
        (endpoint, transportValue, endpoint, endpoint, contextValue, CONCAT(endpoint, ' ', '<', endpoint, '>'), 'pt_BR', 'no', 120, 'textmessages', 'yes', 'subscriptions', 'no', dtmfMode,
         stateBusy, 'all', codec, callGroup, pickupGroup, nat, nat, nat);

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--############-- WEB PHONE --############--
INSERT INTO ps_aors (id, max_contacts, qualify_frequency, remove_existing) VALUES (8701, 1, 120, 'yes');
INSERT INTO ps_auths (id, auth_type, password, username) VALUES (8701, 'userpass', '!vigos!!interface#01!', 8701);
INSERT INTO ps_endpoints (id, transport, aors, auth, context, callerid, language, allow, webrtc, use_avpf, media_encryption, dtls_verify, dtls_setup, ice_support, media_use_received_transport, rtcp_mux, dtls_cert_file, dtls_private_key, dtls_ca_file)
  VALUES
(8701, 'wss_transport', 8701, 8701, 'ddd-celular', '8701 <8701>', 'pt_BR', 'opus,ulaw,vp9,vp8,h264', 'yes', 'yes', 'dtls', 'fingerprint', 'actpass', 'yes', 'yes', 'yes', '/home/vjpbx/certificates/certs/vigoscloud.crt', '/home/vjpbx/certificates/certs/vigoscloud.key', '/home/vjpbx/certificates/ca/vigoscloud-Root-CA.crt');
--########################################--

--############-- SIP PHONE --############--
INSERT INTO ps_aors (id, max_contacts, qualify_frequency, remove_existing) VALUES (0100, 1, 120, 'yes');
INSERT INTO ps_auths (id, auth_type, password, username) VALUES (0100, 'userpass', '!vigos!!interface#01!', 0100);
INSERT INTO ps_endpoints (id, transport, aors, auth, context, callerid, language, inband_progress, rtp_timeout, message_context, allow_subscribe, subscribe_context, direct_media, dtmf_mode, device_state_busy_at, disallow, allow)
  VALUES
(0100, 'udp_transport', 0100, 0100, 'ddd-celular', '0100 <0100>', 'pt_BR', 'no', 120, 'textmessages', 'yes', 'subscriptions', 'no', 'info', 1, 'all', 'ulaw');
--############################################--

--############-- PROVIDER TRUNK IP - NUMBER --############--
INSERT INTO ps_aors (id, contact, qualify_frequency) VALUES (1432352500, 'sip:1432352500@172.26.156.70:5060', 120);
INSERT INTO ps_endpoints (id, transport, context, disallow, allow, aors, from_domain, from_user, direct_media, language, tos_audio, cos_audio)
  VALUES
(1432352500, 'udp_transport', 'Algar-Monsenhor', 'all', 'alaw', '1432352500', '10.61.32.165', '1432352500', 'no', 'pt_BR', 'af42', 3);
INSERT INTO ps_registrations (id, server_uri, client_uri, contact_user, transport, endpoint, line)
VALUES
(1432352500, 'sip:172.26.156.70:5060', 'sip:1432352500@10.61.32.165:5060', '1432352500', 'udp_transport', '1432352500', 'yes');
INSERT INTO ps_endpoint_id_ips (id, endpoint, match) VALUES (1432352500, '1432352500', '172.26.156.70');
--#########################################################--

--#############-- PROVIDER TRUNK IP - NAMED --#############--
INSERT INTO ps_aors (id, contact, qualify_frequency) VALUES ('Embratel', 'sip:1433129900@189.52.73.116:5060', 120);
INSERT INTO ps_endpoints (id, transport, context, disallow, allow, aors, from_domain, from_user, direct_media, language, tos_audio, cos_audio)
  VALUES
('Embratel', 'udp_transport', 'Embratel', 'all', 'alaw', 'Embratel', '200.210.39.6', '1433129900', 'no', 'pt_BR', 'af42', 3);
INSERT INTO ps_registrations (id, server_uri, client_uri, contact_user, transport, endpoint, line)
VALUES
('Embratel', 'sip:189.52.73.116:5060', 'sip:1433129900@200.210.39.6:5060', '1433129900', 'udp_transport', 'Embratel', 'yes');
INSERT INTO ps_endpoint_id_ips (id, endpoint, match) VALUES ('Embratel', 'Embratel', '189.52.73.116');
--########################################################--

--##########-- PROVIDER TRUNK AUTH - NUMBER --#########--
INSERT INTO ps_aors (id, contact, qualify_frequency) VALUES (21061500, 'sip:0537@131.196.224.6:5060', 120);
INSERT INTO ps_auths (id, auth_type, password, username) VALUES (21061500, 'userpass', '2l1@mVcXe37u8i', '0537');
INSERT INTO ps_endpoints (id, transport, context, disallow, allow, aors, direct_media, language, tos_audio, cos_audio, outbound_auth, from_user)
  VALUES
(21061500, 'udp_transport', 'NOVA', 'all', 'ulaw', '21061500', 'no', 'pt_BR', 'af42', 3, '21061500', '0537');
INSERT INTO ps_registrations (id, server_uri, client_uri, contact_user, transport, endpoint)
  VALUES
(21061500, 'sip:0537@131.196.224.6:5060', 'sip:0537@131.196.224.6:5060', '0537', 'udp_transport', '21061500');
INSERT INTO ps_endpoint_id_ips (id, endpoint, match) VALUES (21061500, '21061500', '131.196.224.6');
--#####################################################--

--############-- PROVIDER TRUNK AUTH - NAMED --###########--
INSERT INTO ps_aors (id, contact, qualify_frequency) VALUES ('NOVA', 'sip:131.196.224.6:5060', 120);
INSERT INTO ps_auths (id, auth_type, username, password) VALUES ('NOVA', 'userpass', '0537', '2l1@mVcXe37u8i');
INSERT INTO ps_endpoints (id, transport, context, disallow, allow, aors, direct_media, language, outbound_auth, from_user)
  VALUES
('NOVA', 'udp_transport', 'NOVA', 'all', 'ulaw', 'NOVA', 'no', 'pt_BR', 'NOVA', '0537');
INSERT INTO ps_registrations (id, server_uri, client_uri, contact_user, outbound_auth)
  VALUES
('NOVA', 'sip:0537@131.196.224.6:5060', 'sip:0537@131.196.224.6:5060', '0537', 'NOVA');
INSERT INTO ps_endpoint_id_ips (id, endpoint, match) VALUES ('NOVA', 'NOVA', '131.196.224.6');
--########################################################--

INSERT INTO ps_aors (id, contact, qualify_frequency) VALUES ('DirectCall', 'sip:S8BHM@189.84.129.12:5060', 120);
INSERT INTO ps_auths (id, auth_type, username, password) VALUES ('DirectCall', 'userpass', 'S8BHM', '123456');
INSERT INTO ps_endpoints (id, transport, context, disallow, allow, aors, direct_media, language, outbound_auth)
  VALUES
('DirectCall', 'udp_transport', 'DirectCall', 'all', 'ulaw', 'DirectCall', 'no', 'pt_BR', 'DirectCall');
INSERT INTO ps_registrations (id, server_uri, client_uri, contact_user, outbound_auth)
  VALUES
('DirectCall', 'sip:S8BHM@189.84.129.12:5060', 'sip:S8BHM@192.168.0.41:5060', 'S8BHM', 'DirectCall');
INSERT INTO ps_endpoint_id_ips (id, endpoint, match) VALUES ('DirectCall', 'DirectCall', '189.84.129.12');

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Function IP Trunk Generate --
DROP FUNCTION trunkIPGenerate;
CREATE OR REPLACE FUNCTION trunkIPGenerate(
  provider character varying(50),
  ipSbcTrunk character varying(50),
  ipSipLocal character varying(50),
  keyTrunk character varying(50),
  codec character varying(50)
)
RETURNS boolean 
AS
$$
BEGIN
  IF char_length(provider) > 0 THEN
      INSERT INTO ps_aors (id, contact, qualify_frequency) VALUES (provider, 'sip:' || keyTrunk || '@' || ipSbcTrunk || ':5060', 120);
      INSERT INTO ps_endpoints (id, transport, context, disallow, allow, aors, from_domain, from_user, direct_media, language, tos_audio, cos_audio, dtmf_mode)
        VALUES
      (provider, 'udp_transport', provider, 'all', codec, provider, ipSipLocal, keyTrunk, 'no', 'pt_BR', 'af42', 3, 'auto');
      INSERT INTO ps_registrations (id, server_uri, client_uri, contact_user, transport, endpoint, line)
      VALUES
      (provider, 'sip:' || ipSbcTrunk || ':5060', 'sip:' || keyTrunk || '@' || ipSipLocal || ':5060', keyTrunk, 'udp_transport', provider, 'yes');
      INSERT INTO ps_endpoint_id_ips (id, endpoint, match) VALUES (provider, provider, ipSbcTrunk);
    RETURN True;
  ELSE
    RETURN False;
  END IF;
END;
$$ LANGUAGE plpgsql; 

-- SELECT trunkIPGenerate('ALGAR-REFRIGAS', '201.48.10.3', '44.206.177.167', '1154121500', 'alaw');
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Function Trunk AUTH Generate --
DROP FUNCTION trunkAuthGenerate;
CREATE OR REPLACE FUNCTION trunkAuthGenerate(
  provider character varying(50),
  ipSbcTrunk character varying(50),
  authUserName character varying(50),
  password character varying(50),
  codec character varying(50)
)
RETURNS boolean 
AS
$$
BEGIN
  IF char_length(provider) > 0 THEN
      INSERT INTO ps_aors (id, contact, qualify_frequency) VALUES (provider, 'sip:' || ipSbcTrunk || ':5060', 120);
      INSERT INTO ps_auths (id, auth_type, username, password) VALUES (provider, 'userpass', authUserName, password);
      INSERT INTO ps_endpoints (id, transport, context, disallow, allow, aors, direct_media, language, outbound_auth)
        VALUES
      (provider, 'udp_transport', provider, 'all', codec, provider, 'no', 'pt_BR', provider);
      INSERT INTO ps_registrations (id, server_uri, client_uri, contact_user, outbound_auth)
        VALUES
      (provider, 'sip:' || ipSbcTrunk || ':5060', 'sip:' || authUserName || '@' || ipSbcTrunk || ':5060', authUserName, provider);
      INSERT INTO ps_endpoint_id_ips (id, endpoint, match) VALUES (provider, provider, ipSbcTrunk);
    RETURN True;
  ELSE
    RETURN False;
  END IF;
END;
$$ LANGUAGE plpgsql;

-- SELECT trunkAuthGenerate('DirectCall', '189.84.133.135', 'KZBRI', 'QX1hzIP2YN2fov9w', 'ulaw');
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Function Trunk SELECT --
DROP FUNCTION trunksSelect;
CREATE OR REPLACE FUNCTION trunksSelect()
RETURNS TABLE (
  name character varying(50)
)
  LANGUAGE plpgsql AS
$$
BEGIN
  return QUERY
    SELECT id FROM ps_endpoints WHERE id IN (SELECT id FROM ps_endpoint_id_ips);
END;
$$;

-- SELECT trunksSelect();
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Function Trunk SELECT By Id --
DROP FUNCTION trunksSelectById;
CREATE OR REPLACE FUNCTION trunksSelectById(
  nameTrunk text[]
)
RETURNS TABLE (
  name character varying(150),
  serverIP character varying(150),
  localIP character varying(150),
  trunk character varying(150),
  nameuser character varying(150),
  pass character varying(150)
)
  LANGUAGE plpgsql AS
$$
BEGIN
  return QUERY
    SELECT registry.id, registry.server_uri, registry.client_uri, registry.contact_user, auth.username, auth.password
    FROM ps_registrations AS registry
    LEFT JOIN ps_auths AS auth
    ON registry.id = auth.id
    WHERE registry.id = ANY(nameTrunk);
END;
$$;

-- SELECT trunksSelectById('{Sao_Jose_Rio_Preto}');
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Function Trunk DELETE --
DROP FUNCTION trunkDelete;
CREATE OR REPLACE FUNCTION trunkDelete(
  elements text[]
)
RETURNS boolean 
AS
$$
BEGIN
  IF array_length(elements::text[], 0) IS NULL THEN
      DELETE FROM ps_aors WHERE id = ANY(elements);
      DELETE FROM ps_auths WHERE id = ANY(elements);
      DELETE FROM ps_endpoints WHERE id = ANY(elements);
      DELETE FROM ps_registrations WHERE id = ANY(elements);
      DELETE FROM ps_endpoint_id_ips WHERE id = ANY(elements);
      -- Deletar
    RETURN True;
  ELSE
    RETURN False;
  END IF;
END;
$$ LANGUAGE plpgsql;

-- SELECT trunkDelete(ARRAY['9002', '9910'], 1);
-- SELECT trunkDelete('{AmericaNet-Ford, AmericaNet-Fiat}');
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Function Endpoints SIP Generate --
DROP FUNCTION endpointsSipGenerate;
CREATE OR REPLACE FUNCTION endpointsSipGenerate(
  initEndpoint integer,
  qttEndpoints integer,
  passwordValue character varying(50),
  transportValue character varying(50), -- udp_transport, tcp_transport and wss_transport
  contextValue character varying(50),
  dtmfMode pjsip_dtmf_mode_values_v3, -- 'rfc2833', 'info', 'shortinfo', 'inband', 'auto'
  stateBusy integer, 
  codec character varying(50), -- ulaw or alaw
  callGroup character varying(50),
  pickupGroup character varying(50),
  nat yesno_values
)
RETURNS boolean 
AS
$$
DECLARE
  i integer = (initEndpoint + qttEndpoints) - 1;
BEGIN
  IF initEndpoint > 0 THEN
    FOR endpoint in initEndpoint .. i LOOP
      INSERT INTO ps_aors (id, max_contacts, qualify_frequency, remove_existing) VALUES (endpoint, 1, 120, 'yes');
      INSERT INTO ps_auths (id, auth_type, password, username) VALUES (endpoint, 'userpass', passwordValue, endpoint);
      INSERT INTO ps_endpoints
        (id, transport, aors, auth, context, callerid, language, inband_progress, rtp_timeout, message_context, allow_subscribe, subscribe_context, direct_media, dtmf_mode,
         device_state_busy_at, disallow, allow, named_call_group, named_pickup_group, force_rport, rewrite_contact, rtp_symmetric)
      VALUES
        (endpoint, transportValue, endpoint, endpoint, contextValue, CONCAT(endpoint, ' ', '<', endpoint, '>'), 'pt_BR', 'no', 120, 'textmessages', 'yes', 'subscriptions', 'no', dtmfMode,
         stateBusy, 'all', codec, callGroup, pickupGroup, nat, nat, nat);
    END LOOP;
    RETURN True;
  ELSE
    RETURN False;
  END IF;
END;
$$ LANGUAGE plpgsql;

-- SELECT endpointsSipGenerate('1000', 10, '!vigos!!interface#01!', 'udp_transport', 'ddd-celular', 'info', 1, 'ulaw', 'geral', 'geral', 'no');
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Function Endpoints Web Generate --
DROP FUNCTION endpointsWebGenerate;
CREATE OR REPLACE FUNCTION endpointsWebGenerate(
  initEndpoint integer,
  qttEndpoints integer,
  passwordValue character varying(50),
  transportValue character varying(50), -- udp_transport, tcp_transport and wss_transport
  contextValue character varying(50),
  dtmfMode pjsip_dtmf_mode_values_v3, -- 'rfc2833', 'info', 'shortinfo', 'inband', 'auto'
  stateBusy integer, 
  codec character varying(50), -- ulaw or alaw
  callGroup character varying(50),
  pickupGroup character varying(50),
  nat yesno_values
)
RETURNS boolean
AS
$$
DECLARE
  i integer = (initEndpoint + qttEndpoints) - 1;
BEGIN
  IF initEndpoint > 0 THEN
    FOR endpoint in initEndpoint .. i LOOP
      INSERT INTO ps_aors (id, max_contacts, qualify_frequency, remove_existing) VALUES (endpoint, 1, 120, 'yes');
      INSERT INTO ps_auths (id, auth_type, password, username) VALUES (endpoint, 'userpass', passwordValue, endpoint);
      INSERT INTO ps_endpoints
        (id, transport, aors, auth, context, callerid, language, allow, webrtc, use_avpf, media_encryption, dtls_verify, dtls_setup, ice_support, media_use_received_transport, rtcp_mux, dtmf_mode,
         device_state_busy_at, dtls_cert_file, dtls_private_key, dtls_ca_file, named_call_group, named_pickup_group, rewrite_contact)
      VALUES
        (endpoint, 'wss_transport', endpoint, endpoint, contextValue, CONCAT(endpoint, ' ', '<', endpoint, '>'), 'pt_BR', codec, 'yes', 'yes', 'dtls', 'fingerprint', 'actpass', 'yes', 'yes', 'yes', dtmfMode,
         stateBusy, '/home/vjpbx/certificates/certs/vigoscloud.crt', '/home/vjpbx/certificates/certs/vigoscloud.key', '/home/vjpbx/certificates/ca/vigoscloud-Root-CA.crt', callGroup, pickupGroup, nat);
    END LOOP;
    RETURN True;
  ELSE
    RETURN False;
  END IF;
END;
$$ LANGUAGE plpgsql;


-- SELECT endpointsWebGenerate(4200, 1, '!vigos!!interface#01!', 'wss_transport', 'ddd-celular', 'info', 1, 'opus', 'geral', 'geral', 'no');
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Function Endpoints SELECT --
DROP FUNCTION endpointsSelect;
CREATE OR REPLACE FUNCTION endpointsSelect()
RETURNS TABLE (
  "endpoint" character varying(30),
  "pass" character varying(60),
  "transportName" character varying(30),
  "contextName" character varying(30),
  "languageName" character varying(30),
  "codec" character varying(30),
  "dtmf" pjsip_dtmf_mode_values_v3,
  "busy" integer,
  "callGroup"  character varying(30),
  "captureGroup" character varying(30),
  "nat" yesno_values
)
  LANGUAGE plpgsql AS
$$
BEGIN
  return QUERY
  -- SELECT
  --   id AS endpoint,
  --   transport AS transportName,
  --   context as contextName,
  --   language,
  --   allow AS codec,
  --   dtmf_mode AS dtmf,
  --   device_state_busy_at AS busy,
  --   named_call_group AS callGroup,
  --   named_pickup_group AS captureGroup,
  --   rewrite_contact AS nat
  -- FROM
  --   ps_endpoints
  -- ORDER BY id;
  SELECT
    e.id AS endpoint,
    a.password AS password,
    e.transport AS transportName,
    e.context as contextName,
    e.language,
    e.allow AS codec,
    e.dtmf_mode AS dtmf,
    e.device_state_busy_at AS busy,
    e.named_call_group AS callGroup,
    e.named_pickup_group AS captureGroup,
    e.rewrite_contact AS nat
  FROM
    ps_endpoints AS e
  INNER JOIN ps_auths AS a
  ON e.id = a.id
  ORDER BY e.id;
END;
$$;

-- SELECT endpointsSelect();
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Function Endpoint SELECT By ID --
DROP FUNCTION endpointByIdSelect;
CREATE OR REPLACE FUNCTION endpointByIdSelect(
  elements text[]
)
RETURNS TABLE (
  endpoint character varying(30),
  pass character varying(30),
  transportName character varying(30),
  contextName character varying(30),
  languageName character varying(30),
  codec character varying(30),
  dtmf pjsip_dtmf_mode_values_v3,
  busy integer,
  callGroup  character varying(30),
  captureGroup character varying(30),
  nat yesno_values
) 
AS
$$
BEGIN
  return QUERY
    SELECT
    e.id AS endpoint,
    a.password AS password,
    e.transport AS transportName,
    e.context as contextName,
    e.language,
    e.allow AS codec,
    e.dtmf_mode AS dtmf,
    e.device_state_busy_at AS busy,
    e.named_call_group AS callGroup,
    e.named_pickup_group AS captureGroup,
    e.rewrite_contact AS nat
  FROM
    ps_endpoints AS e
  INNER JOIN ps_auths AS a
  ON e.id = a.id
  WHERE e.id = ANY(elements);
END;
$$ LANGUAGE plpgsql;


-- SELECT endpointByIdSelect(ARRAY["9000"]);
-- SELECT endpointByIdSelect('{9000, 9001}');
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Function Endpoint UPDATE --
DROP FUNCTION endpointsUpdate;
CREATE OR REPLACE FUNCTION endpointsUpdate(
  endpoint text[],
  passwordValue character varying(150),
  transportValue character varying(150), -- udp_transport, tcp_transport and wss_transport
  contextValue character varying(150),
  languageValue character varying(150),
  dtmfMode pjsip_dtmf_mode_values_v3, -- 'rfc2833', 'info', 'shortinfo', 'inband', 'auto'
  stateBusy integer, 
  codec character varying(150), -- ulaw or alaw
  callGroup character varying(150),
  pickupGroup character varying(150),
  nat yesno_values
)
RETURNS boolean
AS
$$
BEGIN
  IF array_length(endpoint::text[], 0) IS NULL THEN
      UPDATE ps_auths SET password = passwordValue WHERE id = ANY(endpoint);
      UPDATE ps_endpoints SET 
        (transport, context, language, dtmf_mode, device_state_busy_at, allow, named_call_group, named_pickup_group, force_rport, rewrite_contact, rtp_symmetric)
        =
        (transportValue, contextValue, languageValue, dtmfMode, stateBusy, codec, callGroup, pickupGroup, nat, nat, nat)
      WHERE id = ANY(endpoint);
    RETURN True;
  ELSE
    RETURN False;
  END IF;
END;
$$ LANGUAGE plpgsql;

-- SELECT endpointsUpdate('{1001}', '!vigos!!interface#01!', 'tcp_transport', 'ddd-celular', 'pt_BR', 'info', 1, 'ulaw', 'geral', 'geral', 'yes');
-- SELECT endpointsSipGenerate('1000', 10, '!vigos!!interface#01!', 'udp_transport', 'ddd-celular', 'info', 1, 'ulaw', 'geral', 'geral', 'no');
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Function Endpoints DELETE --
DROP FUNCTION endpointDelete;
CREATE OR REPLACE FUNCTION endpointDelete(
  elements text[]
)
RETURNS boolean 
AS
$$
BEGIN
  IF array_length(elements::bigint[], 0) IS NULL THEN
      DELETE FROM ps_aors WHERE id = ANY(elements);
      DELETE FROM ps_auths WHERE id = ANY(elements);
      DELETE FROM ps_endpoints WHERE id = ANY(elements);
    RETURN True;
  ELSE
    RETURN False;
  END IF;
END;
$$ LANGUAGE plpgsql;

-- SELECT endpointDelete(ARRAY['4199', '9910'], 1);
-- SELECT endpointDelete('{1037, 1091, 1093}');
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Function Queues Generate --
-- Se "leavewhenempty" for definido como "strict".
-- E "joinempty" definido como "strict".
-- Impedirá que os chamadores de entrada sejam colocados em filas onde não há agentes para atender chamadas.
-- O aplicativo Queue() retornará e o plano de discagem poderá determinar o que fazer em seguida.
-- Essa configuração controla se os chamadores podem ingressar em uma fila sem membros.
-- Existem três escolhas: 
--   yes - os chamadores podem entrar em uma fila sem membros ou apenas membros indisponíveis
--   no - os chamadores não podem entrar em uma fila sem membros
--   strict - os chamadores não podem entrar em uma fila sem membros ou apenas membros indisponíveis
--   soltos - o mesmo que restrito, mas os membros da fila pausados ​​não contar como indisponível

DROP FUNCTION queuesGenerate;
CREATE OR REPLACE FUNCTION queuesGenerate(
  queueName character varying(128),
  queueMusicOnHold character varying(128),
  queueStrategy queue_strategy_values, -- ringall, leastrecent, fewestcalls, random, rrmemory, linear, wrandom, rrordered
  queueAutoFill yesno_values, -- yes or no
  queueMaxLen integer,
  queueRinginuse yesno_values, -- yes or no
  queueAnnouncePosition yesno_values, -- yes or no
  queueAnnounceFrequency integer,
  queueAnnounceHoldTime yesno_values, -- yes or no
  queueMinAnnounceFrequency integer,
  queueSetQueueEntryVarQueue yesno_values, -- yes or no
  queueWrapuptime integer,
  queueJoinempty character varying(128),
  queueLeavewhenempty character varying(128)
)
RETURNS boolean 
AS
$$
BEGIN
  IF CHAR_LENGTH(queueName) > 0 THEN
    INSERT INTO queues (name, musiconhold, strategy, autofill, maxlen, ringinuse, announce_position, announce_frequency, announce_holdtime, min_announce_frequency, setqueueentryvar, wrapuptime, joinempty, leavewhenempty)
      VALUES
    (queueName, queueMusicOnHold, queueStrategy, queueAutoFill, queueMaxLen, queueRinginuse, queueAnnouncePosition, queueAnnounceFrequency, queueAnnounceHoldTime, queueMinAnnounceFrequency, queueSetQueueEntryVarQueue, queueWrapuptime, queueJoinempty, queueLeavewhenempty);
    RETURN True;
  ELSE
    RETURN False;
  END IF;
END;
$$ LANGUAGE plpgsql;

-- SELECT queuesGenerate('atendimento', 'default', 'ringall', 'yes', 20, 'yes', 'yes', 30, 'yes', 30, 'yes', 5, '', ''); -- Com Anuncio
-- SELECT queuesGenerate('teste', 'default', 'ringall', 'yes', 20, 'yes', 'yes', 30, 'yes', 30, 'yes', 5, '', ''); -- Com Anuncio
-- SELECT queuesGenerate('mary-dota', 'default', 'ringall', 'yes', 20, 'yes', 'yes', 30, 'yes', 30, 'yes', 5, '', ''); -- Com Anuncio
-- SELECT queuesGenerate('backoffice-ok', 'default', 'ringall', 'yes', 20, 'yes', 'yes', 30, 'yes', 30, 'yes', 5, '', ''); -- Com Anuncio
-- SELECT queuesGenerate('saleops-ok', 'default', 'ringall', 'yes', 20, 'yes', 'yes', 30, 'yes', 30, 'yes', 5, '', ''); -- Com Anuncio
-- SELECT queuesGenerate('salesenablement-ok', 'default', 'ringall', 'yes', 20, 'yes', 'yes', 30, 'yes', 30, 'yes', 5, '', ''); -- Com Anuncio
-- SELECT queuesGenerate('isr_n1-ok', 'default', 'ringall', 'yes', 20, 'yes', 'yes', 30, 'yes', 30, 'yes', 5, '', ''); -- Com Anuncio
-- SELECT queuesGenerate('isr_n2-ok', 'default', 'ringall', 'yes', 20, 'yes', 'yes', 30, 'yes', 30, 'yes', 5, '', ''); -- Com Anuncio
-- SELECT queuesGenerate('isr_n3-ok', 'default', 'ringall', 'yes', 20, 'yes', 'yes', 30, 'yes', 30, 'yes', 5, '', ''); -- Com Anuncio
-- SELECT queuesGenerate('isr_n4-ok', 'default', 'ringall', 'yes', 20, 'yes', 'yes', 30, 'yes', 30, 'yes', 5, '', ''); -- Com Anuncio

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Function Queue SELECT --
DROP FUNCTION queuesSelect;
CREATE OR REPLACE FUNCTION queuesSelect()
RETURNS TABLE (nameQueue character varying(50))
  LANGUAGE plpgsql AS
$$
BEGIN
  return QUERY
  SELECT
    name
  FROM
    queues
  ORDER BY name;
END;
$$;

-- SELECT queuesSelect();
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Function Queue SELECT By ID --
DROP FUNCTION queueByNameSelect;
CREATE OR REPLACE FUNCTION queueByNameSelect(
  queueName text[]
)
RETURNS TABLE (
  nameQueue character varying(128),
  queueMusicOnHold character varying(128),
  queueStrategy queue_strategy_values, -- ringall, leastrecent, fewestcalls, random, rrmemory, linear, wrandom, rrordered
  queueAutoFill yesno_values, -- yes or no
  queueMaxLen integer,
  queueRinginuse yesno_values, -- yes or no
  queueAnnouncePosition character varying(128), -- yes or no
  queueAnnounceFrequency integer,
  queueAnnounceHoldTime character varying(128), -- yes or no
  queueMinAnnounceFrequency integer,
  queueSetQueueEntryVarQueue yesno_values, -- yes or no
  queueWrapuptime integer,
  queueJoinempty character varying(128),
  queueLeavewhenempty character varying(128)
) 
AS
$$
BEGIN
  return QUERY
  SELECT
    name,
    musiconhold,
    strategy,
    autofill,
    maxlen,
    ringinuse,
    announce_position,
    announce_frequency,
    announce_holdtime,
    min_announce_frequency,
    setqueueentryvar,
    wrapuptime,
    joinempty,
    leavewhenempty
  FROM
    queues
  WHERE name = ANY(queueName);
END;
$$ LANGUAGE plpgsql;

-- SELECT queueByNameSelect('{atendimento}');
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Function Queues Update --
DROP FUNCTION queuesUpdate;
CREATE OR REPLACE FUNCTION queuesUpdate(
  queueName character varying(128),
  queueMusicOnHold character varying(128),
  queueStrategy queue_strategy_values, -- ringall, leastrecent, fewestcalls, random, rrmemory, linear, wrandom, rrordered
  queueAutoFill yesno_values, -- yes or no
  queueMaxLen integer,
  queueRinginuse yesno_values, -- yes or no
  queueAnnouncePosition yesno_values, -- yes or no
  queueAnnounceFrequency integer,
  queueAnnounceHoldTime yesno_values, -- yes or no
  queueMinAnnounceFrequency integer,
  queueSetQueueEntryVarQueue yesno_values, -- yes or no
  queueWrapuptime integer,
  queueJoinempty character varying(128),
  queueLeavewhenempty character varying(128)
)
RETURNS boolean 
AS
$$
BEGIN
  IF CHAR_LENGTH(queueName) > 0 THEN
    UPDATE queues SET
      (musiconhold, strategy, autofill, maxlen, ringinuse, announce_position, announce_frequency, announce_holdtime, min_announce_frequency, setqueueentryvar, wrapuptime, joinempty, leavewhenempty)
    =
      (queueMusicOnHold, queueStrategy, queueAutoFill, queueMaxLen, queueRinginuse, queueAnnouncePosition, queueAnnounceFrequency, queueAnnounceHoldTime, queueMinAnnounceFrequency, queueSetQueueEntryVarQueue, queueWrapuptime, queueJoinempty, queueLeavewhenempty)
    WHERE name = queueName;
    RETURN True;
  ELSE
    RETURN False;
  END IF;
END;
$$ LANGUAGE plpgsql;
  
-- Com anuncio
-- SELECT queuesUpdate('atendimento', 'default', 'ringall', 'yes', 20, 'no', 'yes', 30, 'yes', 30, 'yes', 5, 'strict', 'no');

-- Sem anuncio --- pecas,default,linear,yes,20,no,yes,30,yes,30,yes,5
-- SELECT queuesUpdate('pecas-ford', 'default', 'ringall', 'yes', 20, 'no', 'no', 0, 'no', 0, 'yes', 5, 'strict', 'strict');
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Function Queue Delete --
DROP FUNCTION queueDelete;
CREATE OR REPLACE FUNCTION queueDelete(nameQueue text[])
RETURNS boolean 
AS
$$
BEGIN
  IF array_length(nameQueue::text[], 0) IS NULL  THEN
    DELETE FROM queues WHERE name = ANY(nameQueue);
    RETURN True;
  ELSE
    RETURN False;
  END IF;
END;
$$ LANGUAGE plpgsql;

-- SELECT queueDelete('{AmericaNet}');
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Function Queue Membres Generate --
-- INSERT INTO queue_members (queue_name, interface) VALUES ('crm', 'PJSIP/7251', 1);

DROP FUNCTION queuesMembersGenerate;
CREATE OR REPLACE FUNCTION queuesMembersGenerate(
  nameQueue character varying(128),
  initEndpoint integer,
  finalEndpoint integer,
  penaltyMember integer
)
RETURNS boolean 
AS
$$
DECLARE
  existsUniqueid integer;
BEGIN
  IF initEndpoint > 0 THEN
    FOR endpoint in initEndpoint .. finalEndpoint LOOP
      existsUniqueid = (SELECT COUNT(*) FROM queue_members WHERE uniqueid = endpoint);
      IF existsUniqueid::integer < 1 THEN
        INSERT INTO queue_members (queue_name, interface, penalty, uniqueid) VALUES (nameQueue, CONCAT('PJSIP/', endpoint), penaltyMember, endpoint);
      ELSE
        INSERT INTO queue_members (queue_name, interface, penalty, uniqueid) VALUES (nameQueue, CONCAT('PJSIP/', endpoint), penaltyMember, (endpoint + to_char(ROUND(RANDOM()*10000), '0000')::integer));
      END IF;
    END LOOP;
    RETURN True;
  ELSE
    RETURN False;
  END IF;
END;
$$ LANGUAGE plpgsql;

-- SELECT queuesMembersGenerate('pecas', 6227, 6227, 1);
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Function Members Queues SELECT --
DROP FUNCTION membersQueuesAllSelect;
CREATE OR REPLACE FUNCTION membersQueuesAllSelect()
RETURNS TABLE (
  return_queue_name character varying(128),
  return_interface character varying(128),
  return_membername character varying(128),
  return_state_interface character varying(128),
  return_penalty integer,
  return_paused integer,
  return_uniqueid integer,
  return_wrapuptime integer,
  return_ringinuse ast_bool_values
)
  LANGUAGE plpgsql AS
$$
BEGIN
  return QUERY
  SELECT
    queue_name,
    interface,
    membername,
    state_interface,
    penalty,
    paused,
    uniqueid,
    wrapuptime,
    ringinuse
  FROM
    queue_members
  ORDER BY queue_name;
END;
$$;

-- SELECT membersQueuesAllSelect();
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Function Members By Queue Name SELECT --
DROP FUNCTION membersByQueueNameSelect;
CREATE OR REPLACE FUNCTION membersByQueueNameSelect(
  nameQueue text[]
)
RETURNS TABLE (
  return_queue_name character varying(128),
  return_interface character varying(128),
  return_membername character varying(128),
  return_state_interface character varying(128),
  return_penalty integer,
  return_paused integer,
  return_uniqueid integer,
  return_wrapuptime integer,
  return_ringinuse ast_bool_values
)
  LANGUAGE plpgsql AS
$$
BEGIN
  return QUERY
  SELECT
    queue_name,
    interface,
    membername,
    state_interface,
    penalty,
    paused,
    uniqueid,
    wrapuptime,
    ringinuse
  FROM
    queue_members
  WHERE
    queue_name = ANY(nameQueue)
  ORDER BY queue_name;
END;
$$;

-- SELECT membersByQueueNameSelect('{atendimento}');
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Function Members By Queue Endpoint SELECT --
DROP FUNCTION membersByEndpointSelect;
CREATE OR REPLACE FUNCTION membersByEndpointSelect(
  endpoint character varying(128)
)
RETURNS TABLE (
  return_queue_name character varying(128),
  return_interface character varying(128),
  return_membername character varying(128),
  return_state_interface character varying(128),
  return_penalty integer,
  return_paused integer,
  return_uniqueid integer,
  return_wrapuptime integer,
  return_ringinuse ast_bool_values
)
  LANGUAGE plpgsql AS
$$
DECLARE
      intefaceReceived character varying(128) = CONCAT('PJSIP/', endpoint);
BEGIN
  return QUERY
  SELECT
    queue_name,
    interface,
    membername,
    state_interface,
    penalty,
    paused,
    uniqueid,
    wrapuptime,
    ringinuse
  FROM
    queue_members
  WHERE
    interface = intefaceReceived
  ORDER BY queue_name;
END;
$$;

-- SELECT membersByEndpointSelect('1100');
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Function Member Delete --
DROP FUNCTION memberDelete;
CREATE OR REPLACE FUNCTION memberDelete(
  endpoint character varying(128),
  nameQueue character varying(128)
)
RETURNS boolean 
AS
$$
BEGIN
  IF CHAR_LENGTH(nameQueue) > 0 THEN
    DELETE FROM queue_members WHERE queue_name = nameQueue AND interface LIKE '%' || endpoint;
    RETURN True;
  ELSE
    RETURN False;
  END IF;
END;
$$ LANGUAGE plpgsql;

-- SELECT memberDelete('6305', 'agendamento-hyundai');
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Function Musical On Hold Create --
DROP FUNCTION mohGenerate;
CREATE OR REPLACE FUNCTION mohGenerate(
  mohName character varying(128),
  mohPosition integer, -- 1, 2 ou 3...
  mohEntry character varying(128) -- horario-atendimento.wav -- Caminho do arquivo com extensão.
)
RETURNS boolean 
AS
$$
DECLARE
  updateEntry character varying(128) = CONCAT('/var/lib/asterisk/audios/moh', mohEntry, '.wav');
BEGIN
  IF CHAR_LENGTH(mohName) > 0 THEN
    INSERT INTO musiconhold (name, mode, directory)
      VALUES
    (mohName, 'files', '/var/lib/asterisk/audios/moh');
    INSERT INTO musiconhold_entry (name, position, entry)
      VALUES
    (mohName, mohPosition, updateEntry);
    RETURN True;
  ELSE
    RETURN False;
  END IF;
END;
$$ LANGUAGE plpgsql;

-- SELECT mohGenerate('horario', 1, 'horario-atendimento');
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Function MOH SELECT --
DROP FUNCTION mohSelect;
CREATE OR REPLACE FUNCTION mohSelect()
RETURNS TABLE (
  nameMoh character varying(128),
  positionMoh integer,
  fileName character varying(128)
)
  LANGUAGE plpgsql AS
$$
BEGIN
  return QUERY
  SELECT
    *
  FROM
    musiconhold_entry
  ORDER BY name;
END;
$$;

-- SELECT mohSelect();
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Function MOH DELETE --
DROP FUNCTION mohDelete;
CREATE OR REPLACE FUNCTION mohDelete(
  elements text[]
)
RETURNS boolean 
AS
$$
BEGIN
  IF array_length(elements::text[], 0) IS NULL THEN
      DELETE FROM musiconhold_entry WHERE name = ANY(elements);
      DELETE FROM musiconhold WHERE name = ANY(elements);
    RETURN True;
  ELSE
    RETURN False;
  END IF;
END;
$$ LANGUAGE plpgsql;

-- SELECT mohDelete(ARRAY['4199', '9910'], 1);
-- SELECT mohDelete('{horario}');
---------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- TESTE
SELECT <select_list>
FROM Tabela A
INNER JOIN Tabela B
ON A.Key = B.Key

SELECT
  e.id AS endpoint,
  a.password AS password,
  e.transport AS transportName,
  e.context as contextName,
  e.language,
  e.allow AS codec,
  e.dtmf_mode AS dtmf,
  e.device_state_busy_at AS busy,
  e.named_call_group AS callGroup,
  e.named_pickup_group AS captureGroup,
  e.rewrite_contact AS nat
FROM
  ps_endpoints AS e
INNER JOIN ps_auths AS a
ON e.id = a.id
WHERE e.id = ANY('{7000,7005}');
